# Ollama 서버용 Dockerfile (Render 프리플랜 최적화)
FROM ollama/ollama:latest

# Ollama 서버 포트 설정
EXPOSE 11434

# 환경 변수 설정
ENV OLLAMA_HOST=0.0.0.0
ENV OLLAMA_ORIGINS=*
ENV OLLAMA_KEEP_ALIVE=24h
ENV OLLAMA_NUM_PARALLEL=1
ENV OLLAMA_MAX_LOADED_MODELS=1

# 프리플랜 최적화: 더 작은 모델 사용
RUN ollama pull qwen2.5:1.5b && \
    ollama pull nomic-embed-text

# 헬스체크 추가
HEALTHCHECK --interval=60s --timeout=30s --start-period=120s --retries=2 \
  CMD curl -f http://localhost:11434/api/tags || exit 1

# Ollama 서버 시작
CMD ["ollama", "serve"]